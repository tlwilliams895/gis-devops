<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Fuzzy Search for Report Keywords &#8212; LaunchCode: GIS DevOps  documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/fa/css/all.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/launchcode.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/lc-ed-logo.png" alt="LaunchCode logo"></span>
          GIS DevOps</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="/installations/index.html">Installations</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ol>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day1/index.html">Week 1 - Day 1: Welcome, Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day2/index.html">Week 1 - Day 2: Terminal, Shell, Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day3/index.html">Week 1 - Day 3: Shell, Git, SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day4/index.html">Week 1 - Day 4: SQL, HTTP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day5/index.html">Week 1 - Day 5: HTTP, Docker</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week02/day1/index.html">Week 2 - Day 1: HTML, CSS, Browser DevTools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/day2/index.html">Week 2 - Day 2: HTML/CSS Template, JavaScript Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/day3/index.html">Week 2 - Day 3: Programming Fundamentals, JavaScript, DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/day4/index.html">Week 2 - Day 4: JS, DOM, Promises, AJAX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/day5/index.html">Week 2 - Day 5: Promises, AJAX, HTTP</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day1/index.html">Week 3 - Day 1: Java, OOP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day2/index.html">Week 3 - Day 2: Spring Boot, Controllers, Routes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day3/index.html">Week 3 - Day 3: Models, ORM (Hibernate)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day4/index.html">Week 3 - Day 4: Persistence, ORM Relationships</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day5/index.html">Week 3 - Day 5: Review</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week04/day1/index.html">Week 4 - Day 1: Git, GitLab, IntelliJ, Refactoring, Unit Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/day2/index.html">Week 4 - Day 2: Security, Test-driven development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/day3/index.html">Week 4 - Day 3: Integration testing, dependency injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/day4/index.html">Week 4 - Day 4: Postgres, Spring Data, JPA, Hibernate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/day5/index.html">Week 4 - Day 5: AJAX, Open Layers</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week05/project/index.html">Week 5 - Project Week: Zika Mission Control</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week06/day1/index.html">Week 6 - Day 1: RESTful web services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week06/day2/index.html">Week 6 - Day 2: Swagger REST framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week06/day3/index.html">Week 6 - Day 3: Intro to Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week06/day4/index.html">Week 6 - Day 4: More Elasticsearch, Integrating ES with Spring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week06/day5/index.html">Week 6 - Day 5: ES2015, ESLint, OpenLayers</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../project/index.html">Week 7 - Project Week: Zika Mission Control Part 2</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week08/day1/index.html">Week 8 - Day 1: Intro to DevOps/AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/day2/index.html">Week 8 - Day 2: More with AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/day3/index.html">Week 8 - Day 3: 12 Factor Apps and Auto Scaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/day4/index.html">Week 8 - Day 4: Gradle, Continuous Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/day5/index.html">Week 8 - Day 5: Sonarqube</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week09/project/index.html">Week 9 - Project Week: Zika Mission Control Part 3</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week11/project/index.html">Week 11 - Project Week: Zika Mission Control Part 4</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week12/day3/index.html">Week 12 - Day 3: Intro to Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week12/day4/index.html">Week 12 - Day 4: OAuth 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week12/day5/index.html">Week 12 - Day 5: Certificates</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/aws-intro/index.html">Walkthrough: Intro to AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/aws-rds-vpc/index.html">Walkthrough: Introduction to Amazon Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/certificate-authority/index.html">Certificate Authority</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/client-certificates/index.html">Client Certificates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/docker/index.html">Walkthrough: Intro to Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/elasticsearch-spring/index.html">Walkthrough: Elasticsearch in Spring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/elasticsearch/index.html">Walkthrough: Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/elasticsearch2/index.html">Walkthrough: Elasticsearch Part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/eslint-airwaze/index.html">Walkthrough: ESLint Airwaze</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/gitLab/index.html">Walkthrough: Git and Gitlab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/gradle/index.html">Walkthrough: Gradle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/hashing-salting/index.html">Walkthrough: Hashing and Salting Passwords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/jenkins/index.html">Walkthrough: CI/CD With Jenkins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/launchcart-rest/index.html">Walkthrough: LaunchCart REST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/oauth2/index.html">Visual OAuth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/openlayers/index.html">Walkthrough: OpenLayers and jQuery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/postgress/index.html">Walkthrough: PostgreSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/sonarqube/index.html">Walkthrough: Sonarqube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/spring-data-jpa-hibernate/index.html">Walkthrough: Cars Demo - Spring Data, JPA, Hibernate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/spring-integration-testing/index.html">Walkthrough: Spring Integration Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/swagger/index.html">Walkthrough: SwaggerUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/tdd/index.html">Walkthrough: TDD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/unit-tests/index.html">Walkthrough: Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/upgrading-spring-boot/index.html">Walkthrough: Upgrading to Spring Boot 2.x</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../installations/00-prep-week/index.html">Installation: Essential Tooling &amp; Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/01-docker/index.html">Installation: Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/02-docker-psql/index.html">Installation: Docker PSQL Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/03-docker-postgis/index.html">Installation: Docker PostGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/04-docker-elasticsearch/index.html">Installation: Docker Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/05-docker-kibana/index.html">Installation: Docker Kibana</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/06-docker-jenkins/index.html">Installation: Docker Jenkins</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/00-intellij/index.html">Configuration: IntelliJ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/01-runtime-configurations/index.html">Configuration: IntelliJ - Runtime Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/02-environment-variables-intellij/index.html">Configuration: Environment Variables - IntelliJ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/04-spring-elasticsearch/index.html">Configuration: Spring &amp; Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/05-spring-postgres/index.html">Configuration: Spring &amp; Postgres</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/06-vscode-eslint/index.html">Configuration: Visual Studio Code - ESLint</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../notes/docker/index.html">Docker</a></li>
</ol>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
    <label for="q" class="searchLabel">Search</label>
    <input type="text" name="q" class="form-control" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Fuzzy Search for Report Keywords</a><ul>
<li><a class="reference internal" href="#configure-elasticsearch">Configure Elasticsearch</a></li>
<li><a class="reference internal" href="#configure-spring-to-work-with-elasticsearch">Configure Spring to work with Elasticsearch</a></li>
<li><a class="reference internal" href="#seed-elasticsearch-from-our-postgis-data">Seed Elasticsearch from our PostGIS Data</a></li>
<li><a class="reference internal" href="#amend-our-controllers">Amend our Controllers</a></li>
<li><a class="reference internal" href="#add-search-box-and-button-to-index-html">Add Search Box and Button to <code class="docutils literal notranslate"><span class="pre">index.html</span></code></a></li>
<li><a class="reference internal" href="#amend-script-js">Amend <code class="docutils literal notranslate"><span class="pre">script.js</span></code></a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="fuzzy-search-for-report-keywords">
<span id="week4-fuzzy-search"></span><h1>Fuzzy Search for Report Keywords<a class="headerlink" href="#fuzzy-search-for-report-keywords" title="Permalink to this headline">¶</a></h1>
<p>We have completed a large part of our stakeholder requirements already, but have so far neglected one key request: Elasticsearch.</p>
<p>So far all the requests pull from JpaRepositories, and only touch PostGIS. We have not needed to use Elasticsearch yet so we have conviently worked around it. However, now that we have an explict request for fuzzy search it’s time to work this technology into our project.</p>
<p>So what are we going to have to do?</p>
<dl class="docutils">
<dt>Tasks:</dt>
<dd><ul class="first last simple">
<li>Configure Elasticsearch</li>
<li>Configure Spring to work with Elasticsearch</li>
<li>Seed Elasticsearch from our PostGIS data</li>
<li>Amend our Controllers</li>
<li>Add empty search box, and button to HTML</li>
<li>Amend <code class="docutils literal notranslate"><span class="pre">script.js</span></code></li>
</ul>
</dd>
</dl>
<div class="section" id="configure-elasticsearch">
<h2>Configure Elasticsearch<a class="headerlink" href="#configure-elasticsearch" title="Permalink to this headline">¶</a></h2>
<p>Before we use Elasticsearch in our project we first need to setup Elasticsearch.</p>
<p>Like with PostGIS it would be a good idea to create a new docker container specifically for our container. Giving us additional control over how Elasticsearch runs on our machine.</p>
<p>Review <a class="reference internal" href="../../installations/04-docker-elasticsearch/index.html#docker-elasticsearch"><span class="std std-ref">Installation: Docker Elasticsearch</span></a> for help with creating your new Elasticsearch container.</p>
<div class="admonition">
<p class="first admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p class="last">Remember to stop any running elastcisearch containers you may have running on your machine. It would also be a good idea to name your elasticsearch container for this week something unique like: <code class="docutils literal notranslate"><span class="pre">es-zika-week4</span></code>.</p>
</div>
</div>
<div class="section" id="configure-spring-to-work-with-elasticsearch">
<h2>Configure Spring to work with Elasticsearch<a class="headerlink" href="#configure-spring-to-work-with-elasticsearch" title="Permalink to this headline">¶</a></h2>
<p>Now we will need to configure our Spring application to work with Elasticsearch.</p>
<p>Review <a class="reference internal" href="../../configurations/04-spring-elasticsearch/index.html#spring-elasticsearch"><span class="std std-ref">Configuration: Spring &amp; Elasticsearch</span></a> for assistance.</p>
</div>
<div class="section" id="seed-elasticsearch-from-our-postgis-data">
<h2>Seed Elasticsearch from our PostGIS Data<a class="headerlink" href="#seed-elasticsearch-from-our-postgis-data" title="Permalink to this headline">¶</a></h2>
<p>Now that we have Elasticsearch and Spring working together, we need to get all of the report data out of our PostGIS database, and into our Elasticsearch cluster.</p>
<p>In <a class="reference internal" href="../../walkthroughs/elasticsearch-spring/index.html#walkthrough-elasticsearch-spring"><span class="std std-ref">Walkthrough: Elasticsearch in Spring</span></a> we create an <code class="docutils literal notranslate"><span class="pre">EsController.java</span></code> file which was a RestController with an endpoint that would refresh() our connected Elasticsearch cluster.</p>
<p>We also added code to the <code class="docutils literal notranslate"><span class="pre">EsUtil.java</span></code> file that pulled everything out of our <code class="docutils literal notranslate"><span class="pre">itemRepository</span></code> and then saved it all to our <code class="docutils literal notranslate"><span class="pre">itemDocumentRepository</span></code>.</p>
<p>We want to do a similar thing for our project. But instead of an <code class="docutils literal notranslate"><span class="pre">itemRepository</span></code> and <code class="docutils literal notranslate"><span class="pre">itemDocumentRepository</span></code> we want to use <code class="docutils literal notranslate"><span class="pre">reportRepository</span></code> and <code class="docutils literal notranslate"><span class="pre">reportDocumentRepository</span></code>.</p>
<p>After creating this code you will have to make a POST request to the endpoint you defined to refresh your Elasticsearch cluster.</p>
<div class="admonition">
<p class="first admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p class="last">This will probably take a few minutes. It is loading 240,000 records from our database, and then indexing them into our Elasticsearch cluster. Don’t panic if it looks like it isn’t doing anything for a few minutes.</p>
</div>
<p>Finally to check that Elasticsearch has been seeded correctly you can make a GET request to the new report index: <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">curl</span> <span class="pre">-XGET</span> <span class="pre">127.0.0.1:9200/report/_count</span></code>. This request should give you over 240000 documents.</p>
</div>
<div class="section" id="amend-our-controllers">
<h2>Amend our Controllers<a class="headerlink" href="#amend-our-controllers" title="Permalink to this headline">¶</a></h2>
<p>Elasticsearch is running, connected to our web app, and has been filled with all of the report data. However, we still aren’t using Elasticsearch in our project. We need to change how our Controllers feed data to our <code class="docutils literal notranslate"><span class="pre">script.js</span></code> file.</p>
<p>Currently our <code class="docutils literal notranslate"><span class="pre">script.js</span></code> file makes an AJAX fetch() request including a query parameter with the date. This endpoint only goes to PostGIS to perform the search.</p>
<p>We will need to create a new Controller specifically for Elasticsearch requests. We recommend creating a file called <code class="docutils literal notranslate"><span class="pre">ReportDocumentController.java</span></code>. In this file you will need to create a new endpoint that behaves similarly to the endpoint in your <code class="docutils literal notranslate"><span class="pre">ReportRestController.java</span></code>. However, instead of going to PostGIS, it will go to Elasticsearch to retreive data.</p>
<p>In this new controller file you will need to perform a fuzzy search, you will have to join the documents with location data from PostGIS, and you will have to return it together as a FeatureCollection.</p>
</div>
<div class="section" id="add-search-box-and-button-to-index-html">
<h2>Add Search Box and Button to <code class="docutils literal notranslate"><span class="pre">index.html</span></code><a class="headerlink" href="#add-search-box-and-button-to-index-html" title="Permalink to this headline">¶</a></h2>
<p>Our users will need a way to make a search. They will expect a search box, and search button.</p>
<p>You will need to create these in your <code class="docutils literal notranslate"><span class="pre">index.html</span></code> file, giving them specific ids so you can reference them in your <code class="docutils literal notranslate"><span class="pre">script.js</span></code> file.</p>
<p>You may find the <a class="reference external" href="https://api.jquery.com/click/" target="_blank">jQuery click() documentation<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> useful, you may also want to reference the <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/text" target="_blank">MDN textbox documentation<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>.</p>
</div>
<div class="section" id="amend-script-js">
<h2>Amend <code class="docutils literal notranslate"><span class="pre">script.js</span></code><a class="headerlink" href="#amend-script-js" title="Permalink to this headline">¶</a></h2>
<p>Finally after creating, and amending our previous controllers, and creating the HTML elements we need. We can update the calls made by our <code class="docutils literal notranslate"><span class="pre">script.js</span></code> file to call the new endpoint.</p>
<p>You will have to add some logic to your <code class="docutils literal notranslate"><span class="pre">script.js</span></code> file to make a request based on if an input term is provided in the text box.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>