<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Walkthrough: Elasticsearch Part 2 &#8212; LaunchCode: GIS DevOps  documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/fa/css/all.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/launchcode.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/lc-ed-logo.png" alt="LaunchCode logo"></span>
          GIS DevOps</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ol>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day1/index.html">Week 1 - Day 1: Git, GitLab, IntelliJ, Refactoring, Unit Testing</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day1/index.html#summary">Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day1/index.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day1/index.html#slides">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day1/index.html#walkthrough">Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day1/index.html#exercises">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day1/index.html#studio">Studio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day1/index.html#resources">Resources</a></li>
</ol>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day2/index.html">Week 1 - Day 2: Security, Test-driven development</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day2/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day2/index.html#walkthrough">Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day2/index.html#studio">Studio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day2/index.html#resources">Resources</a></li>
</ol>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day3/index.html">Week 1 - Day 3: Integration testing, dependency injection</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day3/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day3/index.html#walkthrough">Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day3/index.html#studio">Studio</a></li>
</ol>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day4/index.html">Week 1 - Day 4: Postgres, Spring Data, JPA, Hibernate</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day4/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day4/index.html#walkthroughs">Walkthroughs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day4/index.html#studio">Studio</a></li>
</ol>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day5/index.html">Week 1 - Day 5: AJAX, Open Layers</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day5/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day5/index.html#walkthrough">Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day5/index.html#studio">Studio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day5/index.html#retro">Retro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week01/day5/index.html#additional-resources">Additional Resources</a></li>
</ol>
</li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week02/project/index.html">Week 2 - Project Week: Zika Mission Control</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week02/project/index.html#zika-mission-control">Zika Mission Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week02/project/index.html#project-overview">Project Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week02/project/index.html#project-requirements">Project Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week02/project/index.html#primary-objectives">Primary Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week02/project/index.html#secondary-objectives">Secondary Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week02/project/index.html#turning-in-your-work">Turning in Your Work</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week02/project/index.html#check-your-knowledge">Check Your Knowledge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week02/project/index.html#bonus-resources">Bonus Resources</a></li>
</ol>
</li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day1/index.html">Week 3 - Day 1: RESTful web services</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day1/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day1/index.html#walkthrough">Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day1/index.html#studio">Studio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day1/index.html#resources">Resources</a></li>
</ol>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day2/index.html">Week 3 - Day 2 Swagger REST framework</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day2/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day2/index.html#walkthrough">Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day2/index.html#studio">Studio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day2/index.html#resources">Resources</a></li>
</ol>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day3/index.html">Week 3 - Day 3: Intro to Elasticsearch</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day3/index.html#summary">Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day3/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day3/index.html#walkthrough">Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day3/index.html#studio">Studio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day3/index.html#resources">Resources</a></li>
</ol>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day4/index.html">Week 3 - Day 4: More Elasticsearch, Integrating ES with Spring</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day4/index.html#summary">Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day4/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day4/index.html#walkthroughs">Walkthroughs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day4/index.html#studio">Studio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day4/index.html#resources">Resources</a></li>
</ol>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day5/index.html">Week 3 - Day 5: ES2015, ESLint, OpenLayers</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day5/index.html#summary">Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day5/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day5/index.html#walkthrough">Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day5/index.html#studio">Studio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day5/index.html#retro">Retro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week03/day5/index.html#resources">Resources</a></li>
</ol>
</li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week04/project/index.html">Week 4 - Project Week: Zika Mission Control Part 2</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week04/project/index.html#project-requirements">Project Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week04/project/index.html#primary-objectives">Primary Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week04/project/index.html#secondary-objectives">Secondary Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week04/project/index.html#turning-in-your-work">Turning in Your Work</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week04/project/index.html#check-your-knowledge">Check Your Knowledge</a></li>
</ol>
</li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week05/day1/index.html">Week 5 - Day 1: Intro to DevOps/AWS</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week05/day1/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week05/day1/index.html#walkthrough">Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week05/day1/index.html#studio">Studio</a></li>
</ol>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../week05/day2/index.html">Week 5 - Day 2: More with AWS</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week05/day2/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week05/day2/index.html#studio">Studio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week05/day2/index.html#resources">Resources</a></li>
</ol>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../week05/day3/index.html">Week 5 - Day 3: 12 Factor Apps and Auto Scaling</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week05/day3/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week05/day3/index.html#studio">Studio</a></li>
</ol>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../week05/day4/index.html">Week 5 - Day 4: Gradle, Continuous Integration</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week05/day4/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week05/day4/index.html#walkthrough">Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week05/day4/index.html#resources">Resources</a></li>
</ol>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../week05/day5/index.html">Week 5 - Day 5: Sonarqube</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week05/day5/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week05/day5/index.html#walkthrough">Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week05/day5/index.html#retro">Retro</a></li>
</ol>
</li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week06/project/index.html">Week 6 - Project Week: Zika Mission Control Part 3</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week06/project/index.html#project">Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week06/project/index.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week06/project/index.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week06/project/index.html#new-stuff">New Stuff</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week06/project/index.html#milestones">Milestones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week06/project/index.html#debrief">Debrief</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week06/project/index.html#bonus-missions">Bonus Missions</a></li>
</ol>
</li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week08/project/index.html">Week 8 - Project Week: Zika Mission Control Part 4</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week08/project/index.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week08/project/index.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week08/project/index.html#normalizing-data">Normalizing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week08/project/index.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week08/project/index.html#integrating-geoserver">Integrating GeoServer</a></li>
</ol>
</li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week09/day3/index.html">Week 9 - Day 3: Intro to Docker</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week09/day3/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week09/day3/index.html#walkthrough">Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week09/day3/index.html#studio">Studio</a></li>
</ol>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../week09/day4/index.html">Week 9 - Day 4: OAuth2</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week09/day4/index.html#lesson">Lesson</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week09/day4/index.html#resources">Resources</a></li>
</ol>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../week09/day5/index.html">Week 9 - Day 5: Certificates</a><ol>
<li class="toctree-l2"><a class="reference internal" href="../../week09/day5/index.html#lesson-content">Lesson Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week09/day5/index.html#walkthrough">Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week09/day5/index.html#resources">Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../week09/day5/index.html#retro">Retro</a></li>
</ol>
</li>
</ol>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
    <label for="q" class="searchLabel">Search</label>
    <input type="text" name="q" class="form-control" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Walkthrough: Elasticsearch Part 2</a><ul>
<li><a class="reference internal" href="#getting-ready">Getting Ready</a></li>
<li><a class="reference internal" href="#filters">Filters</a></li>
<li><a class="reference internal" href="#aggregations">Aggregations</a><ul>
<li><a class="reference internal" href="#average">Average</a></li>
<li><a class="reference internal" href="#max">Max</a></li>
<li><a class="reference internal" href="#min">Min</a></li>
<li><a class="reference internal" href="#stats">Stats</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mapping">Mapping</a></li>
<li><a class="reference internal" href="#geoaggregations">GeoAggregations</a><ul>
<li><a class="reference internal" href="#geo-distance">Geo Distance</a></li>
<li><a class="reference internal" href="#geo-bounds">Geo Bounds</a></li>
<li><a class="reference internal" href="#geo-centroid">Geo Centroid</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-features">Other Features</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="walkthrough-elasticsearch-part-2">
<span id="walkthrough-elasticsearch2"></span><h1>Walkthrough: Elasticsearch Part 2<a class="headerlink" href="#walkthrough-elasticsearch-part-2" title="Permalink to this headline">¶</a></h1>
<p>In the previous <a class="reference internal" href="../elasticsearch/index.html#walkthrough-elasticsearch"><span class="std std-ref">Walkthrough: Elasticsearch</span></a> we learned about Elasticsearch terminology, CRUD functionality, Matching, Pagination, boolQuery, and Fuzzy searching.</p>
<p>Today we will be expanding on Elasticsearch by learning about: Filtering, Aggregations, Mapping, and GeoAggregations.</p>
<div class="section" id="getting-ready">
<h2>Getting Ready<a class="headerlink" href="#getting-ready" title="Permalink to this headline">¶</a></h2>
<p>We will be working with the <code class="docutils literal notranslate"><span class="pre">/teams</span></code> index again, which is data about the various MLB baseball teams. You should have 30 documents in the <code class="docutils literal notranslate"><span class="pre">/teams</span></code> index. You can check the number of documents in this index by running: <code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">127.0.0.1:9200/teams/_count</span></code>.</p>
<p>If you don’t have 30 documents, or the <code class="docutils literal notranslate"><span class="pre">/teams</span></code> index doesn’t exist you can get that data with the <a class="reference external" href="https://gitlab.com/LaunchCodeTraining/elasticsearch-practice/blob/master/baseball-teams.sh" target="_blank">baseball-teams.sh script<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>.</p>
</div>
<div class="section" id="filters">
<h2>Filters<a class="headerlink" href="#filters" title="Permalink to this headline">¶</a></h2>
<p>A powerful tool within our Elasticsearch queries is to add a Filter context. The filter context allows us to filter our queries in new ways. What if we wanted to select all the baseball teams that have won one or more world series?</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">GET /teams/_search “filter: range world_series_champions &gt;= 1”</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl -XGET 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go">{</span>
<span class="go">    &quot;query&quot;: {</span>
<span class="go">        &quot;bool&quot;: {</span>
<span class="go">            &quot;must&quot;: { &quot;match_all&quot;: {} },</span>
<span class="go">            &quot;filter&quot;: {</span>
<span class="go">                &quot;range&quot;: {</span>
<span class="go">                    &quot;world_series_champions&quot;: { &quot;gte&quot;: 1 }</span>
<span class="go">                }</span>
<span class="go">            }</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">}&#39;</span>
</pre></div>
</div>
</div>
<p>We found 23 teams that have won at least one world series.</p>
<p>What if we wanted to find baseball teams that have won between 2 and 5 world series?</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">GET /teams/_search “filter: range 2 &gt;= world_series_champions &gt;= 5”</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl -XGET 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go">{</span>
<span class="go">    &quot;query&quot;: {</span>
<span class="go">        &quot;bool&quot;: {</span>
<span class="go">            &quot;must&quot;: { &quot;match_all&quot;: {} },</span>
<span class="go">            &quot;filter&quot;: {</span>
<span class="go">                &quot;range&quot;: {</span>
<span class="go">                    &quot;world_series_champions&quot;: {</span>
<span class="go">                        &quot;gte&quot;: 2,</span>
<span class="go">                        &quot;lte&quot;:  5</span>
<span class="go">                     }</span>
<span class="go">                }</span>
<span class="go">            }</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">}&#39;</span>
</pre></div>
</div>
</div>
<p>We found 14 teams that match our query.</p>
<p>What about teams that have won between 2 and 5 world series in the National League?</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">GET /teams/_search “filter range 2 &gt;= world_series_champions &gt;= 5 National league”</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go"> curl -XGET 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go"> {</span>
<span class="go">     &quot;query&quot;: {</span>
<span class="go">         &quot;bool&quot;: {</span>
<span class="go">             &quot;must&quot;: { &quot;match&quot;: { &quot;league&quot;: &quot;National&quot; } },</span>
<span class="go">             &quot;filter&quot;: {</span>
<span class="go">                 &quot;range&quot;: {</span>
<span class="go">                     &quot;world_series_champions&quot;: {</span>
<span class="go">                         &quot;gte&quot;: 2,</span>
<span class="go">                         &quot;lte&quot;:  5</span>
<span class="go">                         }</span>
<span class="go">                 }</span>
<span class="go">             }</span>
<span class="go">         }</span>
<span class="go">     }</span>
<span class="go"> }&#39;</span>
</pre></div>
</div>
</div>
<p>We found 7 teams that match our query.</p>
<p>What about the teams that have never won a world series?</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">GET /teams/_search “filter range world_series_champions &lt;= 0”</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go"> curl -XGET 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go"> {</span>
<span class="go">     &quot;query&quot;: {</span>
<span class="go">         &quot;bool&quot;: {</span>
<span class="go">             &quot;must&quot;: { &quot;match_all&quot;: {} },</span>
<span class="go">             &quot;filter&quot;: {</span>
<span class="go">                 &quot;range&quot;: {</span>
<span class="go">                     &quot;world_series_champions&quot;: {</span>
<span class="go">                         &quot;lte&quot;:  0</span>
<span class="go">                         }</span>
<span class="go">                 }</span>
<span class="go">             }</span>
<span class="go">         }</span>
<span class="go">     }</span>
<span class="go"> }&#39;</span>
</pre></div>
</div>
</div>
<dl class="docutils">
<dt>The <code class="docutils literal notranslate"><span class="pre">range</span></code> query gives us a few options:</dt>
<dd><ul class="first last simple">
<li>“gte” - greater than or equal to</li>
<li>“lte” - less than or equal to</li>
<li>“lt” - less than</li>
<li>“gt” - greater than</li>
</ul>
</dd>
</dl>
<p>The <code class="docutils literal notranslate"><span class="pre">range</span></code> query also allows us to round, and perform math for dates, and timezones. Checkout the <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html" target="_blank">range documentation<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>.</p>
</div>
<div class="section" id="aggregations">
<h2>Aggregations<a class="headerlink" href="#aggregations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="average">
<h3>Average<a class="headerlink" href="#average" title="Permalink to this headline">¶</a></h3>
<p>Aggreations are a way to describe the data found in a query.</p>
<p>What if we wanted to see the average world series wins?</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">GET /teams/_search “aggregation average world_series_champions”</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go"> curl -XGET 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go"> {</span>
<span class="go">     &quot;aggs&quot;: {</span>
<span class="go">         &quot;avg_world_series_wins&quot;: {</span>
<span class="go">             &quot;avg&quot;: {</span>
<span class="go">                 &quot;field&quot;: &quot;world_series_champions&quot;</span>
<span class="go">                 }</span>
<span class="go">             }</span>
<span class="go">     }</span>
<span class="go"> }&#39;</span>
</pre></div>
</div>
</div>
<p>This gives us an average of 3.8 world series championships.</p>
<p>What about the world series average for the National league?</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">GET /teams/_search “aggregation National league average world_series_champions”</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go"> curl -XGET 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go"> {</span>
<span class="go">     &quot;query&quot;: {</span>
<span class="go">         &quot;match&quot;: {</span>
<span class="go">             &quot;league&quot;: &quot;National&quot;</span>
<span class="go">         }</span>
<span class="go">     },</span>
<span class="go">     &quot;aggs&quot;: {</span>
<span class="go">         &quot;avg_world_series_wins&quot;: {</span>
<span class="go">             &quot;avg&quot;: {</span>
<span class="go">                 &quot;field&quot;: &quot;world_series_champions&quot;</span>
<span class="go">                 }</span>
<span class="go">             }</span>
<span class="go">     }</span>
<span class="go"> }&#39;</span>
</pre></div>
</div>
</div>
<p>We get an average of 3.2 for the National league. What about the American league?</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">GET /teams/_search “aggregation American league average world_series_champions”</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go"> curl -XGET 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go"> {</span>
<span class="go">     &quot;query&quot;: {</span>
<span class="go">         &quot;match&quot;: {</span>
<span class="go">             &quot;league&quot;: &quot;American&quot;</span>
<span class="go">         }</span>
<span class="go">     },</span>
<span class="go">     &quot;aggs&quot;: {</span>
<span class="go">         &quot;avg_world_series_wins&quot;: {</span>
<span class="go">             &quot;avg&quot;: {</span>
<span class="go">                 &quot;field&quot;: &quot;world_series_champions&quot;</span>
<span class="go">                 }</span>
<span class="go">             }</span>
<span class="go">     }</span>
<span class="go"> }&#39;</span>
</pre></div>
</div>
</div>
<p>We get an average of 4.4 for the American league.</p>
</div>
<div class="section" id="max">
<h3>Max<a class="headerlink" href="#max" title="Permalink to this headline">¶</a></h3>
<p>We can also find the max value with aggregations.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">GET /teams/_search “aggregation: max world_series_champions”</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go"> curl -XGET 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go"> {</span>
<span class="go">     &quot;aggs&quot;: {</span>
<span class="go">         &quot;max_world_series_wins&quot;: {</span>
<span class="go">             &quot;max&quot;: {</span>
<span class="go">                 &quot;field&quot;: &quot;world_series_champions&quot;</span>
<span class="go">                 }</span>
<span class="go">             }</span>
<span class="go">     }</span>
<span class="go"> }&#39;</span>
</pre></div>
</div>
</div>
<p>We find that the max number of wins is 27.</p>
</div>
<div class="section" id="min">
<h3>Min<a class="headerlink" href="#min" title="Permalink to this headline">¶</a></h3>
<p>We can also find the minimum number of world series wins.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">GET /teams/_search “aggregation: min world_series_champions”</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go"> curl -XGET 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go"> {</span>
<span class="go">     &quot;aggs&quot;: {</span>
<span class="go">         &quot;min_world_series_wins&quot;: {</span>
<span class="go">             &quot;min&quot;: {</span>
<span class="go">                 &quot;field&quot;: &quot;world_series_champions&quot;</span>
<span class="go">                 }</span>
<span class="go">             }</span>
<span class="go">     }</span>
<span class="go"> }&#39;</span>
</pre></div>
</div>
</div>
<p>Which we find is 0, a stat we knew about when we filtered by teams that had zero or less world series championships.</p>
</div>
<div class="section" id="stats">
<h3>Stats<a class="headerlink" href="#stats" title="Permalink to this headline">¶</a></h3>
<p>We also have a handy <code class="docutils literal notranslate"><span class="pre">stats</span> <span class="pre">aggregation</span></code> that compiles various stats.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">GET /teams/_search “aggregation: stats world_series_champions”</span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl -XGET 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go">{</span>
<span class="go">    &quot;aggs&quot;: {</span>
<span class="go">        &quot;world_series_champions_stats&quot;: {</span>
<span class="go">            &quot;stats&quot;: {</span>
<span class="go">                &quot;field&quot;: &quot;world_series_champions&quot;</span>
<span class="go">            }</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">}&#39;</span>
</pre></div>
</div>
</div>
<p>This gives us a decent collection of stats.</p>
<p>You can learn more by reading the <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics.html" target="_blank">aggregation documentation<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>.</p>
</div>
</div>
<div class="section" id="mapping">
<h2>Mapping<a class="headerlink" href="#mapping" title="Permalink to this headline">¶</a></h2>
<p>From the <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html" target="_blank">mapping documentation<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>: Mapping is the process of defining how a document, and the fields it contains, are stored and indexed.</p>
<p>We haven’t learned about mapping yet because Elasticsearch dynamically maps indicies, however when you need more control over the data types of the fields within a mapping, or when you are working with GEOINT you need to explicitly create an index’s mapping.</p>
<p>Let’s look at the current mapping of the <code class="docutils literal notranslate"><span class="pre">/teams</span></code> index.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">GET /teams</span><a class="headerlink" href="#id11" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl 127.0.0.1:9200/teams?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
</pre></div>
</div>
</div>
<dl class="docutils">
<dt>We currently have these properties:</dt>
<dd><ul class="first last simple">
<li>city with type text</li>
<li>country with type text</li>
<li>division with type text</li>
<li>league with type text</li>
<li>name with type text</li>
<li>state with type text</li>
<li>world_series_champions with type long</li>
</ul>
</dd>
</dl>
<p>Pretty straightforward so far, but what if we wanted to add the property “stadium_location” a Geopoint that contains the Latitude and Longitude of the stadium?</p>
<p>Since a Geopoint is a type of GEOINT we will have to explicitly add this property to the mapping.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">PUT /teams ERROR</span><a class="headerlink" href="#id12" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl -XPUT 127.0.0.1:9200/teams -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go">{</span>
<span class="go">    &quot;mappings&quot;: {</span>
<span class="go">        &quot;_doc&quot;: {</span>
<span class="go">            &quot;properties&quot;: {</span>
<span class="go">                &quot;stadium_location&quot;: {</span>
<span class="go">                    &quot;type&quot;: &quot;geo_point&quot;</span>
<span class="go">                }</span>
<span class="go">            }</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">}&#39;</span>
</pre></div>
</div>
</div>
<p>When we run this cURL command we get an error. The resource already exists. This is one of the issues with Elasticsearch since documents are indexed immediately, you cannot update the mapping of an exising index. There are some exceptions, but in our case we need to re-create our index.</p>
<p>Let’s clear out our current <code class="docutils literal notranslate"><span class="pre">/teams</span></code> index.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">DELETE /teams</span><a class="headerlink" href="#id13" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl -XDELETE 127.0.0.1:9200/teams</span>
</pre></div>
</div>
</div>
<p>Now we can re-create our index with an explicit mapping.</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">PUT /teams</span><a class="headerlink" href="#id14" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl -XPUT 127.0.0.1:9200/teams -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go">{</span>
<span class="go">    &quot;mappings&quot;: {</span>
<span class="go">        &quot;_doc&quot;: {</span>
<span class="go">            &quot;properties&quot;: {</span>
<span class="go">                &quot;city&quot;: { &quot;type&quot;: &quot;text&quot; },</span>
<span class="go">                &quot;country&quot;: { &quot;type&quot;: &quot;text&quot; },</span>
<span class="go">                &quot;division&quot;: { &quot;type&quot;: &quot;text&quot; },</span>
<span class="go">                &quot;league&quot;: { &quot;type&quot;: &quot;text&quot; },</span>
<span class="go">                &quot;name&quot;: { &quot;type&quot;: &quot;text&quot; },</span>
<span class="go">                &quot;state&quot;: { &quot;type&quot;: &quot;text&quot; },</span>
<span class="go">                &quot;world_series_champions&quot;: { &quot;type&quot;: &quot;long&quot; },</span>
<span class="go">                &quot;stadium_location&quot;: { &quot;type&quot;: &quot;geo_point&quot; }</span>
<span class="go">            }</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">}&#39;</span>
</pre></div>
</div>
</div>
<p>And now we will need to reindex our teams. Let’s see one as an example.</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">POST /teams/_doc</span><a class="headerlink" href="#id15" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl -XPOST 127.0.0.1:9200/teams/_doc -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go"> {</span>
<span class="go">     &quot;city&quot;: &quot;St. Louis&quot;,</span>
<span class="go">     &quot;country&quot;: &quot;United States&quot;,</span>
<span class="go">     &quot;state&quot;: &quot;Missouri&quot;,</span>
<span class="go">     &quot;name&quot;: &quot;Cardinals&quot;,</span>
<span class="go">     &quot;league&quot;: &quot;National&quot;,</span>
<span class="go">     &quot;division&quot;: &quot;Central&quot;,</span>
<span class="go">     &quot;world_series_champions&quot;: 11,</span>
<span class="go">     &quot;stadium_location&quot;: {</span>
<span class="go">         &quot;lat&quot;: 38.622641,</span>
<span class="go">         &quot;lon&quot;: -90.192819</span>
<span class="go">     }</span>
<span class="go"> }&#39;</span>
</pre></div>
</div>
</div>
<p>Let’s look at this new addition to our new <code class="docutils literal notranslate"><span class="pre">/teams</span></code> index.</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">GET /teams/_search</span><a class="headerlink" href="#id16" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl 127.0.0.1:9200/teams/_search?pretty=true</span>
</pre></div>
</div>
</div>
<p>We have successfully added a new team with a geo_point for the property “stadium_location”.</p>
<p>Let’s re-create our <code class="docutils literal notranslate"><span class="pre">/teams</span></code> index with the <a class="reference external" href="https://gitlab.com/LaunchCodeTraining/elasticsearch-practice/blob/master/baseball-teams-stadiums.sh" target="_blank">baseball-teams-stadiums.sh script<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>.</p>
<p>Save/copy the script, give the script permission to run, and then run the script.</p>
<p>Now let’s look at the new geo_points we added.</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">GET /teams/_search</span><a class="headerlink" href="#id17" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go">{</span>
<span class="go">    &quot;from&quot;: 0,</span>
<span class="go">    &quot;size&quot;: 30,</span>
<span class="go">    &quot;_source&quot;: [&quot;name&quot;, &quot;stadium_location&quot;],</span>
<span class="go">    &quot;query&quot;: { &quot;match_all&quot;: {} }</span>
<span class="go">}&#39;</span>
</pre></div>
</div>
</div>
<p>It looks like it worked!</p>
</div>
<div class="section" id="geoaggregations">
<h2>GeoAggregations<a class="headerlink" href="#geoaggregations" title="Permalink to this headline">¶</a></h2>
<p>Why did we go through all that work?</p>
<p>Elasticsearch supports all sorts of aggregations based around GEOINT.</p>
<div class="section" id="geo-distance">
<h3>Geo Distance<a class="headerlink" href="#geo-distance" title="Permalink to this headline">¶</a></h3>
<p>Let’s find the baseball stadiums within 20km of the LaunchCode Mentor Center (<a class="reference external" href="https://www.google.com/maps/place/38%C2%B039'05.5%22N+90%C2%B015'34.2%22W/&#64;38.6515262,-90.2616837,17z/data=!3m1!4b1!4m5!3m4!1s0x0:0x0!8m2!3d38.651522!4d-90.259495" target="_blank">“lat”: 38.651522, “lon”: -90.259495<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>).</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">geo_distance 20km</span><a class="headerlink" href="#id18" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go">{</span>
<span class="go">    &quot;query&quot;: {</span>
<span class="go">        &quot;bool&quot;: {</span>
<span class="go">            &quot;filter&quot;: {</span>
<span class="go">                &quot;geo_distance&quot;: {</span>
<span class="go">                    &quot;distance&quot;: &quot;20km&quot;,</span>
<span class="go">                    &quot;stadium_location&quot;: {</span>
<span class="go">                        &quot;lat&quot;: 38.651522,</span>
<span class="go">                        &quot;lon&quot;: -90.259495</span>
<span class="go">                    }</span>
<span class="go">                }</span>
<span class="go">            }</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">}&#39;</span>
</pre></div>
</div>
</div>
<p>We got 1 hit! The St. Louis Cardinals play within 20km of the Mentor Center. Let’s expand the search to 500km.</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">geo_distance 500km</span><a class="headerlink" href="#id19" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go">{</span>
<span class="go">    &quot;query&quot;: {</span>
<span class="go">        &quot;bool&quot;: {</span>
<span class="go">            &quot;filter&quot;: {</span>
<span class="go">                &quot;geo_distance&quot;: {</span>
<span class="go">                    &quot;distance&quot;: &quot;500km&quot;,</span>
<span class="go">                    &quot;stadium_location&quot;: {</span>
<span class="go">                        &quot;lat&quot;: 38.651522,</span>
<span class="go">                        &quot;lon&quot;: -90.259495</span>
<span class="go">                    }</span>
<span class="go">                }</span>
<span class="go">            }</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">}&#39;</span>
</pre></div>
</div>
</div>
<p>We got 4 hits this time: the Chicago Cubs, the Chicago White Sox, the Kansas City Royals, and the St. Louis Cardinals.</p>
</div>
<div class="section" id="geo-bounds">
<h3>Geo Bounds<a class="headerlink" href="#geo-bounds" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">geobounds full MLB</span><a class="headerlink" href="#id20" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go">{</span>
<span class="go">    &quot;query&quot;: { &quot;match_all&quot;: {} },</span>
<span class="go">    &quot;aggs&quot;: {</span>
<span class="go">        &quot;stadium_bounds&quot;: {</span>
<span class="go">            &quot;geo_bounds&quot;: {</span>
<span class="go">                &quot;field&quot;: &quot;stadium_location&quot;</span>
<span class="go">            }</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">}&#39;</span>
</pre></div>
</div>
</div>
<p>This gives us two points, we could use to draw a box around all of the stadiums. It’s not very useful in this context because it’s just a box covering the majority of the continental United States, and some of Canada. However, it could be more useful to visualize the area of each division.</p>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">geobounds</span><a class="headerlink" href="#id21" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go"> curl 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go"> {</span>
<span class="go">     &quot;query&quot;: {</span>
<span class="go">         &quot;bool&quot;: {</span>
<span class="go">             &quot;must&quot;: [</span>
<span class="go">                 { &quot;match&quot;: { &quot;league&quot;: &quot;American&quot; } },</span>
<span class="go">                 { &quot;match&quot;: { &quot;division&quot;: &quot;Central&quot; } }</span>
<span class="go">             ]</span>
<span class="go">         }</span>
<span class="go">     },</span>
<span class="go">     &quot;aggs&quot;: {</span>
<span class="go">         &quot;al_central_stadium_bounds&quot;: {</span>
<span class="go">             &quot;geo_bounds&quot;: {</span>
<span class="go">                 &quot;field&quot;: &quot;stadium_location&quot;</span>
<span class="go">             }</span>
<span class="go">         }</span>
<span class="go">     }</span>
<span class="go"> }&#39;</span>
</pre></div>
</div>
</div>
<p>In this case we get a better understanding of the area these teams draw fans, and could benefit from media deals.</p>
</div>
<div class="section" id="geo-centroid">
<h3>Geo Centroid<a class="headerlink" href="#geo-centroid" title="Permalink to this headline">¶</a></h3>
<p>Instead of calculating the area of all of our stadiums, a more benefical calculation could be the centroid. Or the geo point in the center of the polygon created by connecting all of the stadium locations.</p>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">geocentroid</span><a class="headerlink" href="#id22" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go">{</span>
<span class="go">    &quot;query&quot;: { &quot;match_all&quot;: {} },</span>
<span class="go">    &quot;aggs&quot;: {</span>
<span class="go">        &quot;stadium_centroid&quot;: {</span>
<span class="go">            &quot;geo_centroid&quot;: {</span>
<span class="go">                &quot;field&quot;: &quot;stadium_location&quot;</span>
<span class="go">            }</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">}&#39;</span>
</pre></div>
</div>
</div>
<p>We have found the centroid of all the stadiums in the MLB. At “lat”: 38.17771242745221 “lon” : -92.48515307530761. Pulling this <a class="reference external" href="https://www.google.com/maps/place/38%C2%B010'39.8%22N+92%C2%B029'06.6%22W/&#64;38.175995,-92.6250644,11z/data=!4m5!3m4!1s0x0:0x0!8m2!3d38.1777124!4d-92.4851531" target="_blank">point<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> up on a map shows us south central Missouri, just east of the Lake of the Ozarks.</p>
<p>What about the centroid for just American League East Division?</p>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">geocentroid AL East</span><a class="headerlink" href="#id23" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">curl 127.0.0.1:9200/teams/_search?pretty=true -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="go">{</span>
<span class="go">    &quot;query&quot;: {</span>
<span class="go">        &quot;bool&quot;: {</span>
<span class="go">            &quot;must&quot;: [</span>
<span class="go">                { &quot;match&quot;: { &quot;league&quot;: &quot;American&quot; } },</span>
<span class="go">                { &quot;match&quot;: { &quot;division&quot;: &quot;East&quot; } }</span>
<span class="go">            ]</span>
<span class="go">        }</span>
<span class="go">     },</span>
<span class="go">    &quot;aggs&quot;: {</span>
<span class="go">        &quot;stadium_centroid&quot;: {</span>
<span class="go">            &quot;geo_centroid&quot;: {</span>
<span class="go">                &quot;field&quot;: &quot;stadium_location&quot;</span>
<span class="go">            }</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">}&#39;</span>
</pre></div>
</div>
</div>
<p>This time our centroid is in <a class="reference external" href="https://www.google.com/maps/place/38%C2%B046'26.6%22N+76%C2%B044'15.2%22W/&#64;38.7741692,-77.017703,10z/data=!4m5!3m4!1s0x0:0x0!8m2!3d38.7740536!4d-76.7375409" target="_blank">southern Maryland<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>, east and slightly south of Washington D.C.</p>
</div>
</div>
<div class="section" id="other-features">
<h2>Other Features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h2>
<p>We have covered a lot of ground with Elasticsearch, and still have barely touched on the features of this technology. You will get more experience with Elasticsearch throughout this class, but mainly through our Spring web apps, and how we interface with Elasticsearch will change. However, it is still crucial to understand how Elasticsearch works and what is going on under the hood.</p>
<dl class="docutils">
<dt>If you are interested in learning more check out the following topics:</dt>
<dd><ul class="first last simple">
<li>Boost</li>
<li>Highlight</li>
<li>Parent/Child Relationships</li>
<li>Joins</li>
<li>Analyzers</li>
</ul>
</dd>
</dl>
<p>And of course you should always reference the <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" target="_blank">Elasticsearch documentation<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> when you have questions.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../../_sources/walkthroughs/elasticsearch2/index.rst.txt"
     rel="nofollow">Page Source</a>
</div>
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>