<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Scaling horizontally AutoScaling Group &#8212; LaunchCode: GIS DevOps  documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/fa/css/all.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/launchcode.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/lc-ed-logo.png" alt="LaunchCode logo"></span>
          GIS DevOps</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="/installations/index.html">Installations</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ol>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day1/index.html">Week 1 - Day 1: Welcome, Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day2/index.html">Week 1 - Day 2: Terminal, Shell, Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day3/index.html">Week 1 - Day 3: Shell, Git, SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day4/index.html">Week 1 - Day 4: SQL, HTTP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day5/index.html">Week 1 - Day 5: HTTP, Docker</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week02/day1/index.html">Week 2 - Day 1: HTML, CSS, Browser DevTools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/day2/index.html">Week 2 - Day 2: HTML/CSS Template, JavaScript Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/day3/index.html">Week 2 - Day 3: Programming Fundamentals, JavaScript, DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/day4/index.html">Week 2 - Day 4: JS, DOM, Promises, AJAX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/day5/index.html">Week 2 - Day 5: Promises, AJAX, HTTP</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day1/index.html">Week 3 - Day 1: Java, OOP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day2/index.html">Week 3 - Day 2: Spring Boot, Controllers, Routes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day3/index.html">Week 3 - Day 3: Models, ORM (Hibernate)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day4/index.html">Week 3 - Day 4: Persistence, ORM Relationships</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day5/index.html">Week 3 - Day 5: Review</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week04/day1/index.html">Week 4 - Day 1: Git, GitLab, IntelliJ, Refactoring, Unit Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/day2/index.html">Week 4 - Day 2: Security, Test-driven development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/day3/index.html">Week 4 - Day 3: Integration testing, dependency injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/day4/index.html">Week 4 - Day 4: Postgres, Spring Data, JPA, Hibernate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/day5/index.html">Week 4 - Day 5: AJAX, Open Layers</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week05/project/index.html">Week 5 - Project Week: Zika Mission Control</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week06/day1/index.html">Week 6 - Day 1: RESTful web services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week06/day2/index.html">Week 6 - Day 2: Swagger REST framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week06/day3/index.html">Week 6 - Day 3: Intro to Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week06/day4/index.html">Week 6 - Day 4: More Elasticsearch, Integrating ES with Spring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week06/day5/index.html">Week 6 - Day 5: ES2015, ESLint, OpenLayers</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week07/project/index.html">Week 7 - Project Week: Zika Mission Control Part 2</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week08/day1/index.html">Week 8 - Day 1: Intro to DevOps/AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/day2/index.html">Week 8 - Day 2: More with AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/day3/index.html">Week 8 - Day 3: 12 Factor Apps and Auto Scaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/day4/index.html">Week 8 - Day 4: Gradle, Continuous Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/day5/index.html">Week 8 - Day 5: Sonarqube</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week09/project/index.html">Week 9 - Project Week: Zika Mission Control Part 3</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week11/project/index.html">Week 11 - Project Week: Zika Mission Control Part 4</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week12/day3/index.html">Week 12 - Day 3: Intro to Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week12/day4/index.html">Week 12 - Day 4: OAuth 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week12/day5/index.html">Week 12 - Day 5: Certificates</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/aws-intro/index.html">Walkthrough: Intro to AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/aws-rds-vpc/index.html">Walkthrough: Introduction to Amazon Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/certificate-authority/index.html">Certificate Authority</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/client-certificates/index.html">Client Certificates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/docker/index.html">Walkthrough: Intro to Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/elasticsearch-spring/index.html">Walkthrough: Elasticsearch in Spring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/elasticsearch/index.html">Walkthrough: Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/elasticsearch2/index.html">Walkthrough: Elasticsearch Part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/eslint-airwaze/index.html">Walkthrough: ESLint Airwaze</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/gitLab/index.html">Walkthrough: Git and Gitlab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/gradle/index.html">Walkthrough: Gradle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/hashing-salting/index.html">Walkthrough: Hashing and Salting Passwords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/jenkins/index.html">Walkthrough: CI/CD With Jenkins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/launchcart-rest/index.html">Walkthrough: LaunchCart REST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/oauth2/index.html">Visual OAuth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/openlayers/index.html">Walkthrough: OpenLayers and jQuery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/postgress/index.html">Walkthrough: PostgreSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/sonarqube/index.html">Walkthrough: Sonarqube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/spring-data-jpa-hibernate/index.html">Walkthrough: Cars Demo - Spring Data, JPA, Hibernate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/spring-integration-testing/index.html">Walkthrough: Spring Integration Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/swagger/index.html">Walkthrough: SwaggerUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/tdd/index.html">Walkthrough: TDD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/unit-tests/index.html">Walkthrough: Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../walkthroughs/upgrading-spring-boot/index.html">Walkthrough: Upgrading to Spring Boot 2.x</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../installations/00-prep-week/index.html">Installation: Essential Tooling &amp; Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/01-docker/index.html">Installation: Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/02-docker-psql/index.html">Installation: Docker PSQL Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/03-docker-postgis/index.html">Installation: Docker PostGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/04-docker-elasticsearch/index.html">Installation: Docker Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/05-docker-kibana/index.html">Installation: Docker Kibana</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/06-docker-jenkins/index.html">Installation: Docker Jenkins</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/00-intellij/index.html">Configuration: IntelliJ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/01-runtime-configurations/index.html">Configuration: IntelliJ - Runtime Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/02-environment-variables-intellij/index.html">Configuration: Environment Variables - IntelliJ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/04-spring-elasticsearch/index.html">Configuration: Spring &amp; Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/05-spring-postgres/index.html">Configuration: Spring &amp; Postgres</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/06-vscode-eslint/index.html">Configuration: Visual Studio Code - ESLint</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../notes/docker/index.html">Docker</a></li>
</ol>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
    <label for="q" class="searchLabel">Search</label>
    <input type="text" name="q" class="form-control" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Scaling horizontally AutoScaling Group</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#new-topics">New Topics</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setup">Setup</a><ul>
<li><a class="reference internal" href="#create-a-keypair-for-the-region-if-in-new-region">Create a KeyPair for the Region (if in new Region)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#aws-cli">1) AWS CLI</a><ul>
<li><a class="reference internal" href="#install-aws-cli">Install AWS CLI</a></li>
<li><a class="reference internal" href="#aws-cli-credentials">AWS CLI Credentials</a></li>
<li><a class="reference internal" href="#enter-your-credentials-into-aws-cli">Enter Your Credentials into AWS CLI</a></li>
<li><a class="reference internal" href="#run-aws-cli-commands">Run AWS CLI Commands</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configure-your-vpc-via-cloudformation">2) Configure your VPC via CloudFormation</a><ul>
<li><a class="reference internal" href="#download-and-review-the-cloudformation-script">Download and Review the CloudFormation Script</a></li>
<li><a class="reference internal" href="#create-vpc-with-cloudformation-script">Create VPC with CloudFormation Script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configure-buckets">3) Configure Buckets</a><ul>
<li><a class="reference internal" href="#put-your-jar-in-the-bucket">Put your .jar in the Bucket</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-an-ec2-to-populate-the-database">4) Create an EC2 to Populate the Database</a></li>
<li><a class="reference internal" href="#create-the-launch-configuration">5) Create the Launch Configuration</a><ul>
<li><a class="reference internal" href="#user-data-script-remember-to-change-certain-parts">User Data Script (remember to change certain parts)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-the-auto-scale-group">6) Create the Auto Scale Group</a></li>
<li><a class="reference internal" href="#placing-load-on-your-app">7) Placing Load on your App</a><ul>
<li><a class="reference internal" href="#beware-of-the-load-test-tool">Beware of the Load Test Tool</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="scaling-horizontally-autoscaling-group">
<span id="studio-aws-auto-scaling"></span><h1>Scaling horizontally AutoScaling Group<a class="headerlink" href="#scaling-horizontally-autoscaling-group" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The ability to scale horizontally is very important in building Cloud Native applications.  In this studio, you will be extending your <a class="reference external" href="https://gitlab.com/LaunchCodeTraining/airwaze-studio" target="_blank">Airwaze App<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> to scale horizontally as traffic on the server increases.</p>
<div class="section" id="new-topics">
<h3>New Topics<a class="headerlink" href="#new-topics" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Cloud Formation Script for VPC</li>
<li>S3 Bucket</li>
<li>AWS CLI</li>
<li>Auto Scaling</li>
</ul>
</div>
</div>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>You can do this studio in any <strong>US Region</strong> that has not reached it’s VPC limit. N.Virginia and Oregon have the highest VPC limit.</p>
<div class="section" id="create-a-keypair-for-the-region-if-in-new-region">
<h3>Create a KeyPair for the Region (if in new Region)<a class="headerlink" href="#create-a-keypair-for-the-region-if-in-new-region" title="Permalink to this headline">¶</a></h3>
<p><strong>IF</strong> you are in a new Region, you will need to create a new KeyPair.</p>
<ol class="arabic simple">
<li>Make sure you are in the new region</li>
<li>Go to EC2 in the services menu</li>
<li>Click <strong>Key Pairs</strong> in the left menu in the <strong>NETWORK &amp; SECURITY</strong> section</li>
<li>Enter a name like <code class="docutils literal notranslate"><span class="pre">yourname-region-name-key</span></code></li>
<li>Download key</li>
<li>Copy the key to your <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code> folder</li>
<li>Make it so that only the owner can read and write to the file <code class="docutils literal notranslate"><span class="pre">$chmod</span> <span class="pre">400</span> <span class="pre">yourname-useast-key.pem</span></code></li>
</ol>
</div>
</div>
<div class="section" id="aws-cli">
<h2>1) AWS CLI<a class="headerlink" href="#aws-cli" title="Permalink to this headline">¶</a></h2>
<p>We will be using the <a class="reference external" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-welcome.html" target="_blank">AWS CLI tool<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> for some parts of the studio.  The AWS CLI tool allows you to create and change infrastructure on the cloud via the command line.</p>
<div class="section" id="install-aws-cli">
<h3>Install AWS CLI<a class="headerlink" href="#install-aws-cli" title="Permalink to this headline">¶</a></h3>
<p>To install the AWS CLI tool run the following commands in your terminal:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(on local computer)
$ brew install awscli
$ aws --version
</pre></div>
</div>
</div>
<div class="section" id="aws-cli-credentials">
<h3>AWS CLI Credentials<a class="headerlink" href="#aws-cli-credentials" title="Permalink to this headline">¶</a></h3>
<p>Create AWS CLI credentials</p>
<ol class="arabic simple">
<li>Go to <strong>Services &gt; IAM &gt; Users</strong></li>
<li>Click on <strong>yourself</strong> in the list</li>
<li>Click <strong>Security credentails</strong> tab</li>
</ol>
<p>Screenshot of IAM credentails</p>
<blockquote>
<div><img alt="../../_images/iam_get_credentials.png" src="../../_images/iam_get_credentials.png" />
</div></blockquote>
<ol class="arabic simple" start="4">
<li>Click <strong>Create Access Key</strong></li>
<li>Copy or write down the <strong>Secret Key</strong><ul>
<li><strong>WARNING</strong>: You will not be able to see the secret code after closing the new key window</li>
<li>If you do close the window before copying the key, you can remove the key and create a new one</li>
</ul>
</li>
</ol>
<p>Screenshot of Create Access Key</p>
<blockquote>
<div><img alt="../../_images/aws-cli-key.png" src="../../_images/aws-cli-key.png" />
</div></blockquote>
<div class="admonition">
<p class="first admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p class="last">It is very important that you keep the <code class="docutils literal notranslate"><span class="pre">AWS</span> <span class="pre">Secret</span> <span class="pre">Access</span> <span class="pre">Key</span></code> <strong>private</strong>.  Keep it secret, Keep it safe!
Access to that key allows anyone to programmatically create infrastructure(servers, rds, etc) on the AWS account.</p>
</div>
</div>
<div class="section" id="enter-your-credentials-into-aws-cli">
<h3>Enter Your Credentials into AWS CLI<a class="headerlink" href="#enter-your-credentials-into-aws-cli" title="Permalink to this headline">¶</a></h3>
<p>Next run the below command and configure your the AWS CLI tool.  Use the “Default region name” or <code class="docutils literal notranslate"><span class="pre">us-east-1</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(on local computer)
$ aws configure
AWS Access Key ID [None]: AK-------------------
AWS Secret Access Key [None]: r4------------------
Default region name [None]: (just hit enter)
Default output format [None]: (just hit enter)
</pre></div>
</div>
</div>
<div class="section" id="run-aws-cli-commands">
<h3>Run AWS CLI Commands<a class="headerlink" href="#run-aws-cli-commands" title="Permalink to this headline">¶</a></h3>
<p>You should now be able to run commands against AWS.  For example, you should now be able to list all of the buckets in S3::</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ aws s3 ls
</pre></div>
</div>
<p>Take a look around by looking at the help pages for a couple of commands::</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ aws help
$ aws s3 help
$ aws s3 sync help
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">aws</span> <span class="pre">help</span></code> command is a quick alternative to looking up information about the tool on line.</p>
</div>
</div>
<div class="section" id="configure-your-vpc-via-cloudformation">
<h2>2) Configure your VPC via CloudFormation<a class="headerlink" href="#configure-your-vpc-via-cloudformation" title="Permalink to this headline">¶</a></h2>
<p>You are going to use <a class="reference external" href="https://aws.amazon.com/cloudformation/" target="_blank">Amazon CloudFormation<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> to create your VPC.  CloudFormation can create infrastructure on AWS based on a JSON template.  CloudFormation allows you to create consistent, reproducible AWS environments.</p>
<p>You’ll be using a CloudFormation template that adds:</p>
<ul class="simple">
<li>4 Subnets</li>
<li>3 Security Groups</li>
<li>1 RDS</li>
</ul>
<p>Finally AWS CloudFormation will pull the template from an S3 bucket.</p>
<div class="section" id="download-and-review-the-cloudformation-script">
<h3>Download and Review the CloudFormation Script<a class="headerlink" href="#download-and-review-the-cloudformation-script" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Take a look at the template by downloading it with the <code class="docutils literal notranslate"><span class="pre">aws-cli</span></code> tool (command shown below)</li>
<li>Then open <code class="docutils literal notranslate"><span class="pre">airwaze_cloudformation.json</span></code> in your favorite editor</li>
<li>You should recognize the names and properties listed from previous studios<ul>
<li>The only new thing is seeing them in this format.</li>
</ul>
</li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ mkdir ~/s3-sync/cloud
$ aws s3 sync s3://launchcode-gisdevops-cloudformation ~/s3-sync/cloud
$ cd ~/s3-sync/cloud
(then open the airwaze_cloudformation.json file)
</pre></div>
</div>
</div>
<div class="section" id="create-vpc-with-cloudformation-script">
<h3>Create VPC with CloudFormation Script<a class="headerlink" href="#create-vpc-with-cloudformation-script" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Go to services menu</li>
<li>Enter “CloudFormation” into the search bar</li>
<li>Click on <strong>Cloud Formation</strong> search result</li>
<li>Click orange <strong>Create Stack</strong> button</li>
<li>Choose <strong>Specify an Amazon S3 template URL</strong> and paste in <a class="reference external" href="https://s3.amazonaws.com/launchcode-gisdevops-cloudformation/airwaze_cloudformation.json" target="_blank">https://s3.amazonaws.com/launchcode-gisdevops-cloudformation/airwaze_cloudformation.json<i class="fas fa-external-link-alt" aria-hidden="true"></i></a></li>
<li>Click <strong>Next</strong></li>
</ol>
<p>Screenshot of CloudFormation Screen 1</p>
<blockquote>
<div><img alt="../../_images/stack_screen_1.png" src="../../_images/stack_screen_1.png" />
</div></blockquote>
<p>Next we need to give your stack a name and pass along a few parameters to customize the VPC.</p>
<ol class="arabic simple" start="7">
<li>Fill in <strong>Stack Name</strong> with “airwaze-{your name}”.</li>
<li>Fill in <strong>DatabasePassword</strong> with “verysecurepassword” (not this exact password, something you want).</li>
<li>For <strong>KeyName</strong> select your Key Pair(.pem file) for this Region</li>
</ol>
<p>Screenshot of Stack parameters</p>
<blockquote>
<div><img alt="../../_images/stack-parameters2.png" src="../../_images/stack-parameters2.png" />
</div></blockquote>
<ul class="simple">
<li>Click Next on the “Options Screen”</li>
<li>Click Create on the “Review Screen”</li>
</ul>
<p>It will take CloudFormations about 15 minutes to create and run your VPC.  The “Events” tab will give you continuous updates on the progress of the job.
Be sure to note the name and VPC ID of the VPC that is created.</p>
</div>
</div>
<div class="section" id="configure-buckets">
<h2>3) Configure Buckets<a class="headerlink" href="#configure-buckets" title="Permalink to this headline">¶</a></h2>
<p>Since you will be scaling machines horizontally, you <strong>WON’T</strong> be able to manually <code class="docutils literal notranslate"><span class="pre">scp</span></code> a jar to each machine.  Instead, the machines will reach out and grab a copy of the jar when they start.  The servers will download a copy of your application jar from S3.</p>
<p>First create a new bucket in S3.  Remember <strong>EVERY</strong> bucket name for S3 in the whole wide world has to be unique.  Use the pattern below to get a unique name.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ aws s3 mb s3://launchcode-gisdevops-c1-yourname/
</pre></div>
</div>
<p>Run <code class="docutils literal notranslate"><span class="pre">aws</span> <span class="pre">s3</span> <span class="pre">ls</span></code> to make sure that the bucket was created properly.</p>
<div class="section" id="put-your-jar-in-the-bucket">
<h3>Put your .jar in the Bucket<a class="headerlink" href="#put-your-jar-in-the-bucket" title="Permalink to this headline">¶</a></h3>
<p>Locate a <code class="docutils literal notranslate"><span class="pre">.jar</span></code> for Airwaze that you deployed for Day 2 Studio. Rename it to <code class="docutils literal notranslate"><span class="pre">app.jar</span></code> and upload the jar to S3 using the following command::</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ aws s3 cp build/libs/app.jar s3://launchcode-gisdevops-c1-yourname/
$ aws s3 ls s3://launchcode-gisdevops-c1-yourname/ # check to make sure it uploaded
</pre></div>
</div>
</div>
</div>
<div class="section" id="create-an-ec2-to-populate-the-database">
<h2>4) Create an EC2 to Populate the Database<a class="headerlink" href="#create-an-ec2-to-populate-the-database" title="Permalink to this headline">¶</a></h2>
<p>You are going to create an EC2 do some initial database setup. This EC2 will not be used for anything else. Please name it <code class="docutils literal notranslate"><span class="pre">your-name-day3-db-setup</span></code></p>
<ul class="simple">
<li>Create an EC2 instance of the same type as previous days<ul>
<li>Select the VPC that was just crated by the CloudFormation</li>
<li>Select <code class="docutils literal notranslate"><span class="pre">{yourname}-airwaze-SubnetWebAppPublic</span></code> as the subnet</li>
</ul>
</li>
</ul>
<img alt="../../_images/ec2-vpc-subnet2.png" src="../../_images/ec2-vpc-subnet2.png" />
<ul class="simple">
<li>Once the server is up, SSH into the server and run the following commands:</li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(on remote server)
ubuntu$ sudo apt-get update
ubuntu$ sudo apt-get install postgresql
ubuntu$ psql -h airwaze-example.cew68jaqkoek.us-east-1.rds.amazonaws.com -p 5432 -U masterUser airwaze
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(paste this sql into psql shell)
CREATE USER airwaze_user WITH PASSWORD &#39;verysecurepassword&#39;;
CREATE EXTENSION postgis;
CREATE EXTENSION postgis_topology;
CREATE EXTENSION fuzzystrmatch;
CREATE EXTENSION postgis_tiger_geocoder;
CREATE TABLE airport
(
id serial primary key,
airport_id integer,
airport_lat_long geometry,
altitude integer,
city character varying(255),
country character varying(255),
faa_code character varying(255),
icao character varying(255),
name character varying(255),
time_zone character varying(255)
);
CREATE TABLE route
(
id serial primary key,
airline character varying(255),
airline_id integer,
dst character varying(255),
dst_id integer,
route_geom geometry,
src character varying(255),
src_id integer
);
ALTER TABLE airport OWNER to airwaze_user;
ALTER TABLE route OWNER to airwaze_user;
</pre></div>
</div>
<p>Also, send up the <code class="docutils literal notranslate"><span class="pre">routes.csv</span></code> file and the <code class="docutils literal notranslate"><span class="pre">Airports.csv</span></code> file and get those in the database.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(on local computer)
$ scp -i ~/.ssh/mikes-keys.pem routes.csv  ubuntu@35.170.78.180:/home/ubuntu
$ scp -i ~/.ssh/mikes-keys.pem Airports.csv  ubuntu@35.170.78.180:/home/ubuntu
</pre></div>
</div>
<p>Then after the csv files have been copied to the server you can populate the database by running these commands.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(remote server)
ubuntu$ psql -h airwaze-example.cew68jaqkoek.us-east-1.rds.amazonaws.com -d airwaze -U airwaze_user -c &quot;\copy route(src, src_id, dst, dst_id, airline, route_geom) from STDIN DELIMITER &#39;,&#39; CSV HEADER&quot; &lt; /home/ubuntu/routes.csv
ubuntu$ psql -h airwaze-example.cew68jaqkoek.us-east-1.rds.amazonaws.com -d airwaze -U airwaze_user -c &quot;\copy airport(airport_id, name, city, country, faa_code, icao, altitude, time_zone, airport_lat_long) from STDIN DELIMITER &#39;,&#39; CSV HEADER&quot; &lt; /home/ubuntu/Airports.csv
</pre></div>
</div>
</div>
<div class="section" id="create-the-launch-configuration">
<h2>5) Create the Launch Configuration<a class="headerlink" href="#create-the-launch-configuration" title="Permalink to this headline">¶</a></h2>
<p>You now have all of the pieces set up to begin Auto Scaling EC2 machines.</p>
<ul class="simple">
<li>Navigate to <a class="reference external" href="https://console.aws.amazon.com/ec2/autoscaling/home" target="_blank">AutoScaling Page<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> on the sidebar of EC2</li>
<li>Click <strong>Create Auto Scaling Group</strong>.</li>
</ul>
<p>Screenshot of AutoScale Start</p>
<blockquote>
<div><img alt="../../_images/create_auto_scaling_group.png" src="../../_images/create_auto_scaling_group.png" />
</div></blockquote>
<p>A LaunchConfiguration is essentially creating a template for all of the EC2 instances that will be created automatically via Auto Scale.</p>
<ul class="simple">
<li>You are going to create a new Launch Configuration.</li>
</ul>
<p>Screenshot of AutoScale Step 1</p>
<blockquote>
<div><img alt="../../_images/auto_scale_step_1.png" src="../../_images/auto_scale_step_1.png" />
</div></blockquote>
<p>The Launch Configuration is going to be very similar to setting up a normal EC2 instance.</p>
<ul class="simple">
<li>Choose the Ubuntu distribution on the AMI screen.</li>
</ul>
<p>Screenshot of Auto Scale AMI</p>
<blockquote>
<div><img alt="../../_images/auto_scale_ami.png" src="../../_images/auto_scale_ami.png" />
</div></blockquote>
<ul class="simple">
<li>Choose the micro instance.</li>
</ul>
<p>Screenshot of Auto Scale instance size</p>
<blockquote>
<div><img alt="../../_images/auto_scale_instance_size.png" src="../../_images/auto_scale_instance_size.png" />
</div></blockquote>
<p>There are several important configurations that have to be made on the <strong>Configure Details</strong> screen.</p>
<p>The most important configuration is the User data in Advanced Details.  The <strong>User data</strong> is the script that runs as the server starts up.  This script creates the proper directories, configures systemd, and launches the app. Additionally, the app pulls down a copy of the jar file from S3.</p>
<p>There are two pieces of data to change in the <strong>User data</strong> script:</p>
<ul class="simple">
<li>Copy the <strong>User Data script</strong> that is provided below and paste it into an editor</li>
<li>Set <code class="docutils literal notranslate"><span class="pre">APP_DB_HOST</span></code> to the endpoint of your RDS database.</li>
<li>Change the <code class="docutils literal notranslate"><span class="pre">aws</span> <span class="pre">s3</span> <span class="pre">c</span> <span class="pre">s3://launchcode-gisdevops-c1-yourbucket/app.jar</span> <span class="pre">/opt/airwaze/app.jar</span></code> command to point to the bucket that you created earlier in the studio.</li>
<li>Paste your updated script in the “User data” field.</li>
<li>Set “IAM role” to “EC2_to_S3_readonly”. When the machine is starting, the startup script will need to reach out to S3.  The “IAM role” gives the startup script the proper credentials to be authenticated to access S3.</li>
<li>Set the name of the configuration to <code class="docutils literal notranslate"><span class="pre">airwaze-{your</span> <span class="pre">name}-config</span></code>.</li>
<li>Change the “IP Address Type” to be <code class="docutils literal notranslate"><span class="pre">Assign</span> <span class="pre">a</span> <span class="pre">public</span> <span class="pre">IP</span> <span class="pre">address</span> <span class="pre">to</span> <span class="pre">every</span> <span class="pre">instance</span></code>.</li>
</ul>
<p>Screenshot of Auto Scale configuration</p>
<blockquote>
<div><img alt="../../_images/auto_scale_config.png" src="../../_images/auto_scale_config.png" />
</div></blockquote>
<ul class="simple">
<li>Click “Next: Configure Security Group”</li>
<li>On the Security Group screen, choose the <code class="docutils literal notranslate"><span class="pre">WebAppSecurityGroup</span></code> from your VPC.  The key is that you want to have ports 22 and 8080 open on the machines that you are running.</li>
<li>Click “Review”</li>
<li>Click “Create Launch configuration”</li>
</ul>
<div class="section" id="user-data-script-remember-to-change-certain-parts">
<h3>User Data Script (remember to change certain parts)<a class="headerlink" href="#user-data-script-remember-to-change-certain-parts" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
# Install Java
apt-get update -y &amp;&amp; apt-get install -y openjdk-8-jdk awscli

# Create airwaze user
useradd -M airwaze
mkdir /opt/airwaze
mkdir /etc/opt/airwaze
aws s3 cp s3://launchcode-gisdevops-c1-traineemike/app.jar /opt/airwaze/app.jar
chown -R airwaze:airwaze /opt/airwaze /etc/opt/airwaze
chmod 777 /opt/airwaze

# Write Airwaze config file
cat &lt;&lt; EOF &gt; /etc/opt/airwaze/airwaze.config
APP_DB_HOST=airwaze-example.cew68jaqkoek.us-east-1.rds.amazonaws.com
APP_DB_PORT=5432
APP_DB_NAME=airwaze
APP_DB_USER=airwaze_user
APP_DB_PASS=verysecurepassword
EOF

# Write systemd unit file
cat &lt;&lt; EOF &gt; /etc/systemd/system/airwaze.service
[Unit]
Description=Airwaze Studio
After=syslog.target

[Service]
User=airwaze
EnvironmentFile=/etc/opt/airwaze/airwaze.config
ExecStart=/usr/bin/java -jar /opt/airwaze/app.jar SuccessExitStatus=143
Restart=always

[Install]
WantedBy=multi-user.target
EOF

systemctl enable airwaze.service
systemctl start airwaze.service
</pre></div>
</div>
<p>Screenshot of Auto Scale security groups</p>
<blockquote>
<div><img alt="../../_images/auto_scale_security_groupsv3.png" src="../../_images/auto_scale_security_groupsv3.png" />
</div></blockquote>
</div>
</div>
<div class="section" id="create-the-auto-scale-group">
<h2>6) Create the Auto Scale Group<a class="headerlink" href="#create-the-auto-scale-group" title="Permalink to this headline">¶</a></h2>
<p>The Auto Scale Group is the piece of configuration responsible for how and when new machines are spun up (and spun down). Spun up = created and started. Spun down = stopped and possibly deleted.</p>
<p>The first step is configuring where the machines will be spun up.</p>
<ul class="simple">
<li>For “Group name”, provide a name similiar to <code class="docutils literal notranslate"><span class="pre">airwaze-{your</span> <span class="pre">name}</span></code> (replace {your name} of course…)</li>
<li>For “Network”, choose your VPC.</li>
<li>For “Subnet”, choose the <code class="docutils literal notranslate"><span class="pre">SubnetWebAppPublic</span></code>.</li>
<li>Click “Next: Configure Scaling Policy”</li>
</ul>
<p>Screenshot of Auto Scale configuration</p>
<blockquote>
<div><img alt="../../_images/auto_scale_group_1.png" src="../../_images/auto_scale_group_1.png" />
</div></blockquote>
<p>The next screen configures how an app scales up.</p>
<ul class="simple">
<li>Select <code class="docutils literal notranslate"><span class="pre">Use</span> <span class="pre">scaling</span> <span class="pre">policies</span> <span class="pre">to</span> <span class="pre">adjust</span> <span class="pre">the</span> <span class="pre">capacity</span> <span class="pre">of</span> <span class="pre">this</span> <span class="pre">group</span></code>.</li>
<li>Mark that the app can scale up to 5 machines.</li>
<li>Change the name to <code class="docutils literal notranslate"><span class="pre">Scale</span> <span class="pre">Fast!</span></code>.</li>
<li>Set the “Target value” to 5.  “Target value” is the percentage of CPU that triggers another machine to be provisioned.</li>
<li>Set the “Instances need” to 40 seconds.  Since Spring Boot packages the web server in the jar, your application doesn’t need as much start time as other machines.</li>
<li>Click “Next: Configure Notifications”</li>
</ul>
<p>Screenshot of Auto Scale configuration</p>
<blockquote>
<div><img alt="../../_images/auto_scale_group_config.png" src="../../_images/auto_scale_group_config.png" />
</div></blockquote>
<ul class="simple">
<li>Click “Next: Configure Tags”</li>
<li>Click “Review”</li>
<li>Click “Create Auto Scaling Group”</li>
</ul>
<p>This will create you Auto Scaling Group.  At first, the summary page will say 0 instances; it typically takes a couple of minutes to initialize.</p>
<p>Screenshot of Auto Scaling Group Dash</p>
<blockquote>
<div><img alt="../../_images/auto_scaling_group_dash.png" src="../../_images/auto_scaling_group_dash.png" />
</div></blockquote>
<p>The “Instances” tab will show you how many machines you currently have running in your Auto Scaling Group.</p>
<p>Screenshot of the Instances tab</p>
<blockquote>
<div><img alt="../../_images/auto_scaling_instances_tab.png" src="../../_images/auto_scaling_instances_tab.png" />
</div></blockquote>
<p>Next you need to hook a load balancer up to your Auto Scaling Group.</p>
<ul class="simple">
<li>Go to <em>EC2 Dashboard &gt; Auto Scaling Group</em></li>
<li>Find your Auto Scaling Group</li>
<li>Click Edit</li>
</ul>
<p>Screenshot of Target Groups Edit</p>
<blockquote>
<div><img alt="../../_images/target_groups_click_edit.png" src="../../_images/target_groups_click_edit.png" />
</div></blockquote>
<ul class="simple">
<li>Select <code class="docutils literal notranslate"><span class="pre">WebAppTargets</span></code> from the “Target Groups” drop down.</li>
</ul>
<p>Screenshot of Target Groups select target</p>
<blockquote>
<div><img alt="../../_images/target_groups_set_target.png" src="../../_images/target_groups_set_target.png" />
</div></blockquote>
</div>
<div class="section" id="placing-load-on-your-app">
<h2>7) Placing Load on your App<a class="headerlink" href="#placing-load-on-your-app" title="Permalink to this headline">¶</a></h2>
<p>Next, you want to test that your autoscaling is working properly.</p>
<p>Go to the public DNS of your ELB and hit refresh many times. You can even go to that address in multiple browsers at the same time. You are trying to send as many requests as possible to your ELB.</p>
<div class="section" id="beware-of-the-load-test-tool">
<h3>Beware of the Load Test Tool<a class="headerlink" href="#beware-of-the-load-test-tool" title="Permalink to this headline">¶</a></h3>
<p>You can <strong>optionally</strong> use a Node library called <a class="reference external" href="https://www.npmjs.com/package/loadtest" target="_blank">loadtest<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>.
Loadtest measures the average latency time of a concurrent requests to a server.</p>
<div class="admonition">
<p class="first admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p class="last">Note: Tools like loadtest and Apache AB are like guns.  You don’t point them live things unless you want to kill it.  It’s fine to point a load test tool at your non production apps on AWS; in fact you need to make sure that it can handle load.  You would never want to point a load testing tool at a live site because:
* It’s your live site (your staging environment should be similar enough to production to replicate the error).
* Your production site will be sitting behind one or more layers like a CDN.  Your load test is going to look a lot like a denial of service attack. Services like your CDN are designed to recognize and block attacks at the fringe of your network.  Running a load test against a live site is a good way to get your IP address blocked.</p>
</div>
<p>To install <a class="reference external" href="https://www.npmjs.com/package/loadtest" target="_blank">loadtest<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> install the following npm package globally (<code class="docutils literal notranslate"><span class="pre">-g</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo npm install -g loadtest
</pre></div>
</div>
<p>Next, you can run a command to put load on the server. The following command runs 3 requests per second sending 3 concurrent results to the server at a time.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(this starts 3 threads and sends 3 requests a second, don&#39;t run this for very long!)
loadtest -c 3 --rps 3 http://internal-airwa-WebAp-1CT34V4AX36U0-774969334.us-east-1.elb.amazonaws.com
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>